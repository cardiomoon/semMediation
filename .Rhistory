if(!is.null(covar)){
covar$site=lapply(covar$site,function(x) str_replace(x,"M",M))
if(mode){
temp4=addCovarEquation(temp4,covar,prefix=NULL)
} else{
temp4=addCovarEquation(temp4,covar)
}
}
res=seekNameVars(vars,"b")
res
if(!is.null(res)) {
newvars=c(M,res)
temp2=tripleInteraction(newvars,prefix="b",suffix=suffix,mode=mode,addPrefix=FALSE)
suffix=suffix+1
}
temp2
#' @export
#' @examples
#' X="negemot";M="ideology";Y="govact";suffix=0
#' vars=list(name=list(c("sex","age")),site=list(c("a")))
#' moderator=list(name=c("W"),site=list(c("b","c")))
#' covar=list(name=c("C1","C2","C3"),label=c("ese","sex","tenure"),site=list(c("M","Y"),"Y","Y"))
#' cat(tripleEquation(X=X,M=M,Y=Y,vars=vars))
#' cat(tripleEquation(X=X,M=M,Y=Y,vars=vars,moderator=moderator,covar=covar))
#' cat(tripleEquation(X=X,M=M,Y=Y,vars=vars,mode=1))
#' cat(tripleEquation(X=X,M=M,Y=Y,vars=vars,covar=covar,mode=1))
tripleEquation=function(X=NULL,M=NULL,Y=NULL,vars,suffix=0,moderator=list(),covar=NULL,mode=0){
# moderator=list();covar=NULL;mode=0
temp1<-temp2<-temp3<-NULL
(XM=moderator$name[str_detect2(moderator$site,"a")])
(MY=moderator$name[str_detect2(moderator$site,"b")])
(XY=moderator$name[str_detect2(moderator$site,"c")])
res=seekNameVars(vars,"a")
if(!is.null(res)) {
newvars=c(X,res)
temp1=tripleInteraction(newvars,prefix="a",suffix=suffix,mode=mode,addPrefix=FALSE)
suffix=suffix+1
}
temp1
if(!is.null(M)){
XM=c(X,XM)
XMstr=interactStr(XM,addPrefix=FALSE)
temp1=union(temp1,XMstr)
if(mode==0) temp1=paste0("a",1:length(temp1),"*",temp1)
temp4=paste0(M,"~",paste(temp1,collapse="+"))
if(!is.null(covar)){
covar$site=lapply(covar$site,function(x) str_replace(x,"M",M))
if(mode){
temp4=addCovarEquation(temp4,covar,prefix=NULL)
} else{
temp4=addCovarEquation(temp4,covar)
}
}
}
res=seekNameVars(vars,"b")
if(!is.null(res)) {
newvars=c(M,res)
temp2=tripleInteraction(newvars,prefix="b",suffix=suffix,mode=mode,addPrefix=FALSE)
suffix=suffix+1
}
temp2
MY=c(M,MY)
MYstr=interactStr(MY,addPrefix=FALSE)
temp2=union(temp2,MYstr)
if(mode==0) temp2=paste0("b",1:length(temp2),"*",temp2)
res=seekNameVars(vars,"c")
if(!is.null(res)) {
newvars=c(X,res)
temp3=tripleInteraction(newvars,suffix=suffix,mode=mode,addPrefix=FALSE)
}
XY=c(X,XY)
XY
XYstr=interactStr(XY,addPrefix=FALSE)
temp3=union(temp3,XYstr)
if(mode==0) temp3=paste0("c",1:length(temp3),"*",temp3)
temp3
temp=c(temp2,temp3)
temp=paste0(Y,"~",paste(temp,collapse="+"))
if(!is.null(covar)){
covar$site=lapply(covar$site,function(x) str_replace(x,"Y",Y))
if(mode){
temp=addCovarEquation(temp,covar,prefix=NULL)
} else{
temp=addCovarEquation(temp,covar)
}
}
temp=c(temp4,temp)
equation=paste(temp,collapse="\n")
equation
if(mode==0){
moderatorNames=union(unlist(vars$name),moderator$name)
for(i in seq_along(moderatorNames)){
name=moderatorNames[i]
temp=paste0(name," ~ ",name,".mean*1\n")
temp=paste0(temp,name," ~~ ",name,".var*",name,"\n")
equation=paste0(equation,temp)
}
temp=makeIndirectEquation(X,M,temp1,temp2,temp3,moderatorNames,range=TRUE)
equation=paste0(equation,temp)
}
equation
}
#' @export
#' @examples
#' X="negemot";M="ideology";Y="govact";suffix=0
#' vars=list(name=list(c("sex","age")),site=list(c("a")))
#' moderator=list(name=c("W"),site=list(c("b","c")))
#' covar=list(name=c("C1","C2","C3"),label=c("ese","sex","tenure"),site=list(c("M","Y"),"Y","Y"))
#' cat(tripleEquation(X=X,M=M,Y=Y,vars=vars))
#' cat(tripleEquation(X=X,M=M,Y=Y,vars=vars,moderator=moderator,covar=covar))
#' cat(tripleEquation(X=X,M=M,Y=Y,vars=vars,mode=1))
#' cat(tripleEquation(X=X,M=M,Y=Y,vars=vars,covar=covar,mode=1))
tripleEquation=function(X=NULL,M=NULL,Y=NULL,vars,suffix=0,moderator=list(),covar=NULL,mode=0){
# moderator=list();covar=NULL;mode=0
temp1<-temp2<-temp3<-NULL
(XM=moderator$name[str_detect2(moderator$site,"a")])
(MY=moderator$name[str_detect2(moderator$site,"b")])
(XY=moderator$name[str_detect2(moderator$site,"c")])
res=seekNameVars(vars,"a")
if(!is.null(res)) {
newvars=c(X,res)
temp1=tripleInteraction(newvars,prefix="a",suffix=suffix,mode=mode,addPrefix=FALSE)
suffix=suffix+1
}
temp1
if(!is.null(M)){
XM=c(X,XM)
XMstr=interactStr(XM,addPrefix=FALSE)
temp1=union(temp1,XMstr)
if(mode==0) temp1=paste0("a",1:length(temp1),"*",temp1)
temp4=paste0(M,"~",paste(temp1,collapse="+"))
if(!is.null(covar)){
covar$site=lapply(covar$site,function(x) str_replace(x,"M",M))
if(mode){
temp4=addCovarEquation(temp4,covar,prefix=NULL)
} else{
temp4=addCovarEquation(temp4,covar)
}
}
}
res=seekNameVars(vars,"b")
if(!is.null(res)) {
newvars=c(M,res)
temp2=tripleInteraction(newvars,prefix="b",suffix=suffix,mode=mode,addPrefix=FALSE)
suffix=suffix+1
}
temp2
MY=c(M,MY)
MYstr=interactStr(MY,addPrefix=FALSE)
temp2=union(temp2,MYstr)
if(mode==0) temp2=paste0("b",1:length(temp2),"*",temp2)
res=seekNameVars(vars,"c")
if(!is.null(res)) {
newvars=c(X,res)
temp3=tripleInteraction(newvars,suffix=suffix,mode=mode,addPrefix=FALSE)
}
XY=c(X,XY)
XY
XYstr=interactStr(XY,addPrefix=FALSE)
temp3=union(temp3,XYstr)
if(mode==0) temp3=paste0("c",1:length(temp3),"*",temp3)
temp3
temp=c(temp2,temp3)
temp=paste0(Y,"~",paste(temp,collapse="+"))
if(!is.null(covar)){
covar$site=lapply(covar$site,function(x) str_replace(x,"Y",Y))
if(mode){
temp=addCovarEquation(temp,covar,prefix=NULL)
} else{
temp=addCovarEquation(temp,covar)
}
}
temp=c(temp4,temp)
equation=paste(temp,collapse="\n")
equation
if(mode==0){
moderatorNames=union(unlist(vars$name),moderator$name)
for(i in seq_along(moderatorNames)){
name=moderatorNames[i]
temp=paste0(name," ~ ",name,".mean*1\n")
temp=paste0(temp,name," ~~ ",name,".var*",name,"\n")
equation=paste0(equation,temp)
}
temp=makeIndirectEquation(X,M,temp1,temp2,temp3,moderatorNames,range=TRUE)
equation=paste0(equation,temp)
}
equation
}
X="negemot";M="ideology";Y="govact";suffix=0
vars=list(name=list(c("sex","age")),site=list(c("a")))
cat(tripleEquation(X=X,M=M,Y=Y,vars=vars))
devtools::document()
devtools::document()
devtools::check()
X="negemot";Y="govact";suffix=0
vars=list(name=list(c("sex","age")),site=list(c("c")))
cat(tripleEquation(X=X,Y=Y,vars=vars))
#' @export
#' @examples
#' X="negemot";M="ideology";Y="govact";suffix=0
#' vars=list(name=list(c("sex","age")),site=list(c("a")))
#' moderator=list(name=c("W"),site=list(c("b","c")))
#' covar=list(name=c("C1","C2","C3"),label=c("ese","sex","tenure"),site=list(c("M","Y"),"Y","Y"))
#' cat(tripleEquation(X=X,M=M,Y=Y,vars=vars))
#' cat(tripleEquation(X=X,M=M,Y=Y,vars=vars,moderator=moderator,covar=covar))
#' cat(tripleEquation(X=X,M=M,Y=Y,vars=vars,mode=1))
#' cat(tripleEquation(X=X,M=M,Y=Y,vars=vars,covar=covar,mode=1))
tripleEquation=function(X=NULL,M=NULL,Y=NULL,vars,suffix=0,moderator=list(),covar=NULL,mode=0){
# moderator=list();covar=NULL;mode=0
temp1<-temp2<-temp3<-temp4<-NULL
(XM=moderator$name[str_detect2(moderator$site,"a")])
(MY=moderator$name[str_detect2(moderator$site,"b")])
(XY=moderator$name[str_detect2(moderator$site,"c")])
res=seekNameVars(vars,"a")
if(!is.null(res)) {
newvars=c(X,res)
temp1=tripleInteraction(newvars,prefix="a",suffix=suffix,mode=mode,addPrefix=FALSE)
suffix=suffix+1
}
temp1
if(!is.null(M)){
XM=c(X,XM)
XMstr=interactStr(XM,addPrefix=FALSE)
temp1=union(temp1,XMstr)
if(mode==0) temp1=paste0("a",1:length(temp1),"*",temp1)
temp4=paste0(M,"~",paste(temp1,collapse="+"))
if(!is.null(covar)){
covar$site=lapply(covar$site,function(x) str_replace(x,"M",M))
if(mode){
temp4=addCovarEquation(temp4,covar,prefix=NULL)
} else{
temp4=addCovarEquation(temp4,covar)
}
}
}
res=seekNameVars(vars,"b")
if(!is.null(res)) {
newvars=c(M,res)
temp2=tripleInteraction(newvars,prefix="b",suffix=suffix,mode=mode,addPrefix=FALSE)
suffix=suffix+1
}
temp2
MY=c(M,MY)
MYstr=interactStr(MY,addPrefix=FALSE)
temp2=union(temp2,MYstr)
if(mode==0) temp2=paste0("b",1:length(temp2),"*",temp2)
res=seekNameVars(vars,"c")
if(!is.null(res)) {
newvars=c(X,res)
temp3=tripleInteraction(newvars,suffix=suffix,mode=mode,addPrefix=FALSE)
}
XY=c(X,XY)
XY
XYstr=interactStr(XY,addPrefix=FALSE)
temp3=union(temp3,XYstr)
if(mode==0) temp3=paste0("c",1:length(temp3),"*",temp3)
temp3
temp=c(temp2,temp3)
temp=paste0(Y,"~",paste(temp,collapse="+"))
if(!is.null(covar)){
covar$site=lapply(covar$site,function(x) str_replace(x,"Y",Y))
if(mode){
temp=addCovarEquation(temp,covar,prefix=NULL)
} else{
temp=addCovarEquation(temp,covar)
}
}
temp=c(temp4,temp)
equation=paste(temp,collapse="\n")
equation
if(mode==0){
moderatorNames=union(unlist(vars$name),moderator$name)
for(i in seq_along(moderatorNames)){
name=moderatorNames[i]
temp=paste0(name," ~ ",name,".mean*1\n")
temp=paste0(temp,name," ~~ ",name,".var*",name,"\n")
equation=paste0(equation,temp)
}
temp=makeIndirectEquation(X,M,temp1,temp2,temp3,moderatorNames,range=TRUE)
equation=paste0(equation,temp)
}
equation
}
X="negemot";Y="govact";suffix=0
vars=list(name=list(c("sex","age")),site=list(c("c")))
cat(tripleEquation(X=X,Y=Y,vars=vars))
library(semMediation)
cat(tripleEquation(X=X,Y=Y,vars=vars))
cat(tripleEquation(X=X,Y=Y,vars=vars))
#' @param prefix A character
#' @param suffix A number
#' @param mode A number
#' @param addPrefix A logical
#' @importFrom utils combn
#' @export
#' @examples
#' vars=c("negemot","sex","age")
#' tripleInteraction(vars)
#' tripleInteraction(vars,mode=1)
tripleInteraction=function(vars,prefix="c",suffix=0,mode=0,addPrefix=TRUE){
if(mode){
temp=paste(vars,collapse="*")
} else{
result=vars
result=c(result,apply(combn(vars,2),2,function(x){paste(x,collapse=":")}))
result=c(result,paste0("interaction",suffix))
if(addPrefix) {
temp=paste0(prefix,1:length(result),"*",result)
} else{
temp=result
}
}
temp
}
cat(tripleEquation(X=X,Y=Y,vars=vars))
library(semMediation)
X="negemot";Y="govact";suffix=0
vars=list(name=list(c("sex","age")),site=list(c("c")))
cat(tripleEquation(X=X,Y=Y,vars=vars))
library(semMediation)
cat(tripleEquation(X=X,Y=Y,vars=vars))
cat(tripleEquation(X=X,Y=Y,vars=vars,mode=1))
X="negemot";Y="govact";suffix=0
vars=list(name=list(c("sex","age")),site=list(c("c")))
cat(tripleEquation(X=X,Y=Y,vars=vars))
moderator=list();covar=NULL;mode=0
X="negemot";Y="govact";suffix=0
vars=list(name=list(c("sex","age")),site=list(c("c")))
# moderator=list();covar=NULL;mode=0
temp1<-temp2<-temp3<-temp4<-NULL
(XM=moderator$name[str_detect2(moderator$site,"a")])
(MY=moderator$name[str_detect2(moderator$site,"b")])
(XY=moderator$name[str_detect2(moderator$site,"c")])
res=seekNameVars(vars,"a")
if(!is.null(res)) {
newvars=c(X,res)
temp1=tripleInteraction(newvars,prefix="a",suffix=suffix,mode=mode,addPrefix=FALSE)
suffix=suffix+1
}
temp1
if(!is.null(M)){
XM=c(X,XM)
XMstr=interactStr(XM,addPrefix=FALSE)
temp1=union(temp1,XMstr)
if(mode==0) temp1=paste0("a",1:length(temp1),"*",temp1)
temp4=paste0(M,"~",paste(temp1,collapse="+"))
if(!is.null(covar)){
covar$site=lapply(covar$site,function(x) str_replace(x,"M",M))
if(mode){
temp4=addCovarEquation(temp4,covar,prefix=NULL)
} else{
temp4=addCovarEquation(temp4,covar)
}
}
}
moderator=list();covar=NULL;mode=0;M=NULL
X="negemot";Y="govact";suffix=0
vars=list(name=list(c("sex","age")),site=list(c("c")))
# moderator=list();covar=NULL;mode=0;M=NULL
temp1<-temp2<-temp3<-temp4<-NULL
(XM=moderator$name[str_detect2(moderator$site,"a")])
(MY=moderator$name[str_detect2(moderator$site,"b")])
(XY=moderator$name[str_detect2(moderator$site,"c")])
res=seekNameVars(vars,"a")
if(!is.null(res)) {
newvars=c(X,res)
temp1=tripleInteraction(newvars,prefix="a",suffix=suffix,mode=mode,addPrefix=FALSE)
suffix=suffix+1
}
temp1
if(!is.null(M)){
XM=c(X,XM)
XMstr=interactStr(XM,addPrefix=FALSE)
temp1=union(temp1,XMstr)
if(mode==0) temp1=paste0("a",1:length(temp1),"*",temp1)
temp4=paste0(M,"~",paste(temp1,collapse="+"))
if(!is.null(covar)){
covar$site=lapply(covar$site,function(x) str_replace(x,"M",M))
if(mode){
temp4=addCovarEquation(temp4,covar,prefix=NULL)
} else{
temp4=addCovarEquation(temp4,covar)
}
}
}
res=seekNameVars(vars,"b")
if(!is.null(res)) {
newvars=c(M,res)
temp2=tripleInteraction(newvars,prefix="b",suffix=suffix,mode=mode,addPrefix=FALSE)
suffix=suffix+1
}
temp2
MY=c(M,MY)
MYstr=interactStr(MY,addPrefix=FALSE)
temp2=union(temp2,MYstr)
temp2
if(mode==0) temp2=paste0("b",1:length(temp2),"*",temp2)
temp2
temp2
temp2<-NULL
if(mode==0) {
if(length(temp2)>0) temp2=paste0("b",1:length(temp2),"*",temp2)
}
temp2
res=seekNameVars(vars,"c")
if(!is.null(res)) {
newvars=c(X,res)
temp3=tripleInteraction(newvars,suffix=suffix,mode=mode,addPrefix=FALSE)
}
XY=c(X,XY)
XY
XYstr=interactStr(XY,addPrefix=FALSE)
temp3=union(temp3,XYstr)
if(mode==0) temp3=paste0("c",1:length(temp3),"*",temp3)
temp3
temp=c(temp2,temp3)
temp=paste0(Y,"~",paste(temp,collapse="+"))
if(!is.null(covar)){
covar$site=lapply(covar$site,function(x) str_replace(x,"Y",Y))
if(mode){
temp=addCovarEquation(temp,covar,prefix=NULL)
} else{
temp=addCovarEquation(temp,covar)
}
}
temp=c(temp4,temp)
equation=paste(temp,collapse="\n")
equation=paste0(equation,"\n")
if(mode==0){
moderatorNames=union(unlist(vars$name),moderator$name)
for(i in seq_along(moderatorNames)){
name=moderatorNames[i]
temp=paste0(name," ~ ",name,".mean*1\n")
temp=paste0(temp,name," ~~ ",name,".var*",name,"\n")
equation=paste0(equation,temp)
}
temp=makeIndirectEquation(X,M,temp1,temp2,temp3,moderatorNames,range=TRUE)
equation=paste0(equation,temp)
}
equation
library(semMediation)
X="negemot";Y="govact";suffix=0
vars=list(name=list(c("sex","age")),site=list(c("c")))
cat(tripleEquation(X=X,Y=Y,vars=vars))
library(semMediation)
X="negemot";M="ideology";Y="govact";suffix=0
moderator=list(name=c("W"),site=list(c("b","c")))
covar=list(name=c("C1","C2","C3"),label=c("ese","sex","tenure"),site=list(c("M","Y"),"Y","Y"))
cat(tripleEquation(X=X,M=M,Y=Y,moderator=moderator,covar=covar))
X="negemot";M="ideology";Y="govact";suffix=0
moderator=list(name=c("W"),site=list(c("b","c")))
covar=list(name=c("C1","C2","C3"),label=c("ese","sex","tenure"),site=list(c("M","Y"),"Y","Y"))
# moderator=list();covar=NULL;mode=0;M=NULL
mode=0;M=NULL;vars=NULL
# moderator=list();covar=NULL;mode=0;M=NULL
# mode=0;M=NULL;vars=NULL
temp1<-temp2<-temp3<-temp4<-NULL
(XM=moderator$name[str_detect2(moderator$site,"a")])
(MY=moderator$name[str_detect2(moderator$site,"b")])
(XY=moderator$name[str_detect2(moderator$site,"c")])
res=seekNameVars(vars,"a")
library(semMediation)
X="negemot";M="ideology";Y="govact";suffix=0
moderator=list(name=c("W"),site=list(c("b","c")))
covar=list(name=c("C1","C2","C3"),label=c("ese","sex","tenure"),site=list(c("M","Y"),"Y","Y"))
cat(tripleEquation(X=X,M=M,Y=Y,moderator=moderator,covar=covar))
library(semMediation)
cat(tripleEquation(X=X,M=M,Y=Y,moderator=moderator,covar=covar))
library(semMediation)
cat(tripleEquation(X=X,M=M,Y=Y,moderator=moderator,covar=covar))
cat(tripleEquation(X=X,M=M,Y=Y,moderator=moderator,covar=covar,mode=1))
devtools::document()
devtools::check()
library(semMediation)
X="negemot";M="ideology";Y="govact";suffix=0
cat(tripleEquation(X=X,M=M,Y=Y)
)
X="negemot";M="ideology";Y="govact";suffix=0
cat(tripleEquation(X=X,M=M,Y=Y))
X="negemot";Y="govact";suffix=0
moderator=list(name=c("W"),site=list(c("c")))
cat(tripleEquation(X=X,Y=Y,moderator=moderator))
library(semMediation)
runApp('inst/pmacro')
pmacro
runApp('inst/pmacro')
runApp('inst/pmacro')
pmacro
runApp('inst/pmacro')
library(semMediation)
runApp('inst/pmacro')
c(11:13,18:20)
runApp('inst/pmacro')
runApp('inst/pmacro')
X="negemot";M="ideology";Y="govact";suffix=0
vars=list(name=list(c("sex","age")),site=list(c("a")))
library(semMediation)
library(semMediation)
runApp()
runApp()
runApp()
runApp()
runApp()
glbwarm=read.csv("./inst/pmacro/data/glbwarm.csv",stringsAsFactors = FALSE)
glbwarm=read.csv("./data/glbwarm.csv",stringsAsFactors = FALSE)
attach(glbwarm)
lm(ideology ~ negemot*age*sex+negemot+age+negemot:age,data=glbwarm)
fit=lm(ideology ~ negemot*age*sex+negemot+age+negemot:age,data=glbwarm)
summary(fit)
runApp()
runApp()
runApp()
